# `TCP`和`UDP`的区别

**`UDP`和`TCP`的特点：**

- `UDP`：无连接 、不可靠、面向数据报、没有发送缓冲区 

- `TCP`：面向连接、可靠、面向字节流、有发送缓冲区



现在`Internet`上流行的协议是**`TCP/IP`协议**，该协议中对低于1024的端口都有确切的定义，他们对应着`Internet`上一些常见的服务。这些常见的服务可以分为使用`TCP`端口(面向连接)和使用`UDP`端口(面向无连接)两种。



## `TCP`协议简介



`TCP`(`Transmission Control Protocol`，传输控制协议)是面向连接的协议，也就是说，在收发数据前，必须和对方建立可靠的连接。

　　一个`TCP`连接必须要经过三次“对话”才能建立起来，其中的过程非常复杂，只简单的描述下这三次对话的简单过程：主机A向主机B发出连接请求数据包：“我想给你发数据，可以吗?”，这是第一次对话；主机B向主机A发送同意连接和要求同步(同步就是两台主机一个在发送，一个在接收，协调工作)的数据包：“可以，你什么时候发?”，这是第二次对话；主机A再发出一个数据包确认主机B的要求同步：“我现在就发，你接着吧！”，这是第三次对话。三次“对话”的目的是使数据包的发送和接收同步，经过三次“对话”之后，主机A才向主机B正式发送数据。

### `TCP`的三次握手过程如下：

　　1. 主机A通过向主机B发送一个含有同步序列号的标志位的数据段给主机B ，向主机B请求建立连接，通过这个数据段，主机A告诉主机B 两件事：我想要和你通信；你可以用哪个序列号作为起始数据段来回应我。

　　2. 主机B收到主机A的请求后，用一个带有确认应答(`ACK`)和同步序列号(`SYN`)标志位的数据段响应主机A，也告诉主机A两件事：我已经收到你的请求了，你可以传输数据了；你要用哪佧序列号作为起始数据段来回应我。

　　3. 主机A收到这个数据段后，再发送一个确认应答，确认已收到主机B 的数据段：“我已收到回复，我现在要开始传输实际数据了。这样3次握手就完成了，主机A和主机B就可以传输数据了。

### `TCP`建立连接要进行3次握手,而断开连接要进行4次。

　　1. 当主机A完成数据传输后，将控制位`FIN`置1，提出停止`TCP`连接的请求；

　　2. 主机B收到`FIN`后对其作出响应，确认这一方向上的`TCP`连接将关闭，将`ACK`置1；

　　3. 由B端再提出反方向的关闭请求，将`FIN`置1；

　　4. 主机A对主机B的请求进行确认，将`ACK`置1，双方向的关闭结束。

　　由`TCP`的三次握手和四次断开可以看出,`TCP`使用面向连接的通信方式，大大提高了数据通信的可靠性，使发送数据端和接收端在数据正式传输前就有了交互，为数据正式传输打下了可靠的基础。



## `UDP`协议简介



`UDP(User Data Protocol)`——用户数据报协议，是一个简单的面向数据报的运输层协议。`UDP`不提供可靠性，它只是把应用程序传给`IP`层的数据报发送出去，但是并不能保证它们能到达目的地。由于`UDP`在传输数据报前不用在客户和服务器之间建立一个连接，且没有超时重发等机制，故而传输速度很快。

### `UDP`协议具有如下几个特点：

　　(1)`UDP`是一个非连接的协议，传输数据之前源端和终端不建立连接，当它想传送时就简单地去抓取来自应用程序的数据，并尽可能快地把它扔到网络上。在发送端，`UDP`传送数据的速度仅仅是受应用程序生成数据的速度、计算机的能力和传输带宽的限制；在接收端，`UDP`把每个消息段放在队列中，应用程序每次从队列中读一个消息段。

　　(2)由于传输数据不建立连接，因此也就不需要维护连接状态，包括收发状态等，因此一台服务机可同时向多个客户机传输相同的消息。

　　(3)`UDP`信息包的标题很短，只有`8`个字节，相对于`TCP`的`20`个字节信息包的额外开销很小。

　　(4)吞吐量不受拥挤控制算法的调节，只受应用软件生成数据的速率、传输带宽、源端和终端主机性能的限制。

　　(5)`UDP`使用尽最大努力交付，即不保证可靠交付，因此主机不需要维持复杂的链接状态表(这里面有许多参数)。

　　(6)`UDP`是面向报文的。发送方的`UDP`对应用程序交下来的报文，在添加首部后就向下交付给`IP`层。既不拆分，也不合并，而是保留这些报文的边界，因此，应用程序需要选择合适的报文大小。

　　我们经常使用`ping`命令来测试两台主机之间`TCP/IP`通信是否正常，其实`ping`命令的原理就是向对方主机发送`UDP`数据包，然后对方主机确认收到数据包，如果数据包是否到达的消息及时反馈回来，那么网络就是通的。
　　**注意：**虽然`ping`命令发送的`UDP`数据包，但是它使用的协议是`ICMP`协议，是`Internet Control Message Protocol`（`Internet`控制消息协议）的缩写，是`TCP/IP`协议族的一个子协议，用于在`IP`主机、路由器之间传递控制消息。
　　



## `TCP`与`UDP`区别总结

1. `TCP`面向连接(如打电话要先拨号建立连接)；`UDP`是无连接的，即发送数据之前不需要建立连接；

2. `TCP`提供可靠的服务。也就是说，通过`TCP`连接传送的数据，无差错，不丢失，不重复，且按序到达；`UDP`尽最大努力交付，也不保证可靠交付；

3. `TCP`面向字节流，实际上是`TCP`把数据看成一连串无结构的字节流；`UDP`是面向报文的；

4. `UDP`没有拥塞控制，因此网络出现拥塞不会使源主机的发送速率降低(对实时应用很有用，如`IP`电话，实时视频会议等)；

5. 每一条`TCP`连接只能是点到点的；`UDP`支持一对一，一对多，多对一和多对多的交互通信；

6. `TCP`首部开销20字节；`UDP`的首部开销小，只有8个字节；

7. `TCP`的逻辑通信信道是全双工的可靠信道，`UDP`则是不可靠信道。



## 应用场合

`UDP`适用于不需要`TCP`可靠机制的情形，比如，当高层协议或应用程序提供错误和流控制功能的时候，`UDP`是传输层协议，服务于很多知名应用层协议，包括网络文件系统(`NFS`)、简单网络管理协议(`SNMP`)、域名系统(`DNS`)以及简单文件传输系统(`TFTP`)。比如，日常生活中，常见使用`UDP`协议的应用如下： `QQ`语音、`QQ`视频、`TFTP` ……。

　　`TCP`是一种面向连接的、可靠的、基于字节流的运输层通信协议，通常由`IETF`的`RFC793`说明。在简化的计算机网络`OSI`模型中，它完成运输层所指定的功能。一些要求比较高的服务一般使用这个协议，如`FTP`、`Telne`、`SMTP`、`HTTP`、`POP3`等。